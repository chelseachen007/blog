(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{537:function(t,s,a){"use strict";a.r(s);var n=a(45),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"监控系统文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控系统文档"}},[t._v("#")]),t._v(" 监控系统文档")]),t._v(" "),a("h2",{attrs:{id:"全局-config"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局-config"}},[t._v("#")]),t._v(" 全局 config")]),t._v(" "),a("p",[t._v("最终希望可以通过服务端下发，但是这样要考虑跨域问题(优先级低)")]),t._v(" "),a("p",[t._v("config 列表")]),t._v(" "),a("ul",[a("li",[t._v("版本")]),t._v(" "),a("li",[t._v("过滤次数")]),t._v(" "),a("li",[t._v("过滤某些错误")]),t._v(" "),a("li",[t._v("请求路径")]),t._v(" "),a("li",[t._v("...")])]),t._v(" "),a("h2",{attrs:{id:"rrweb-问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rrweb-问题"}},[t._v("#")]),t._v(" RRWEB 问题")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("MutationObserver API 不能监听 DOM 大小变化和颜色等变化（待验证）")])]),t._v(" "),a("li",[a("p",[t._v("当前方案直接将前 20S 操作上传，会造成请求包体太大，导致超过 Get 请求限制而无法上传，")]),t._v(" "),a("p",[t._v("准备将其改造成时间数组（切片为 1S）单独定时定长的上传，而错误只上传发生时对应的秒数，由后端计算后返回前几秒的数组")]),t._v(" "),a("ul",[a("li",[t._v("问题 1 上报时间数组 需要 id 识别身份？")])])])]),t._v(" "),a("h2",{attrs:{id:"http-劫持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-劫持"}},[t._v("#")]),t._v(" Http 劫持")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("准备改成保留原始请求一份，像上报接口使用原始请求，不做劫持，不然会死循环")])]),t._v(" "),a("li",[a("p",[t._v("使用 new Images(.../1*1.gif) 上报")])]),t._v(" "),a("li",[a("p",[t._v("适配器模式")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("如果是浏览器环境引入"),a("code",[t._v("xhr")]),t._v("，是"),a("code",[t._v("node")]),t._v("环境则引入"),a("code",[t._v("http")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDefaultAdapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" adapter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据 XMLHttpRequest 判断")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" XMLHttpRequest "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'undefined'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// For browsers use XHR adapter")]),t._v("\n    adapter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./adapters/xhr'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据 process 判断")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" process "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'undefined'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'[object process]'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// For node use HTTP adapter")]),t._v("\n    adapter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./adapters/http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" adapter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" defaults "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  adapter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDefaultAdapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])])])]),t._v(" "),a("ul",[a("li")]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li")]),t._v(" "),a("h2",{attrs:{id:"重构问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重构问题"}},[t._v("#")]),t._v(" 重构问题")]),t._v(" "),a("p",[t._v("发现大部分代码冗余重复较多，比如每个请求都进行了 baseMsg，type，获取错误 event 的，想要改造成，通过事件中心统一进行数据的存储和上报")]),t._v(" "),a("p",[t._v("存储事件准备改造成统一函数，例如：")]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveTo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("wx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" wx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localstroage\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("indexDB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" indexDB"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localstroage\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("但这种改造不容易扩展，另外如果做取数据函数同样也要判断环境，先想好兼容形式怎么做")]),t._v(" "),a("p",[t._v("Report Class 大概")]),t._v(" "),a("div",{staticClass:"language-JavaScript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//去重")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//过滤错误")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//存储错误")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("jserror"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("promiseError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("resError"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forEach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("v")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// saveTo")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 定时上报")]),t._v("\n")])])]),a("h2",{attrs:{id:"打包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包"}},[t._v("#")]),t._v(" 打包")]),t._v(" "),a("p",[t._v("webpack => rollup")]),t._v(" "),a("h2",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),a("p",[t._v("现在自己测试太麻烦，思考做成单元测试（不优先）")]),t._v(" "),a("p",[t._v("js 问题")]),t._v(" "),a("ul",[a("li",[t._v("undefined")]),t._v(" "),a("li",[t._v("promise")]),t._v(" "),a("li",[t._v("referror")])]),t._v(" "),a("p",[t._v("网络请求")]),t._v(" "),a("ul",[a("li",[t._v("xml")]),t._v(" "),a("li",[t._v("fetch")])]),t._v(" "),a("p",[t._v("vue")]),t._v(" "),a("ul",[a("li",[t._v("组件声明")]),t._v(" "),a("li",[t._v("未响应式")]),t._v(" "),a("li",[t._v("key 相等")])]),t._v(" "),a("p",[t._v("待补充...")]),t._v(" "),a("h2",{attrs:{id:"做这个系统的收益"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#做这个系统的收益"}},[t._v("#")]),t._v(" 做这个系统的收益")]),t._v(" "),a("p",[t._v("缩短可交互 js 时间")])])}),[],!1,null,null,null);s.default=e.exports}}]);